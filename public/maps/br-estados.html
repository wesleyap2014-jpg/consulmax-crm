<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mapa do Brasil (UF) - Consulmax</title>

    <style>
      :root {
        --cx-rubi: #a11c27;
        --cx-navy: #1e293f;

        --map-fill: #d3dee2; /* cinza base */
        --map-stroke: #ffffff;

        --map-active: var(--cx-rubi); /* rubi Consulmax */
        --map-selected: #7f1420; /* rubi mais escuro */

        --map-disabled-opacity: 0.55;

        --card-bg: rgba(245, 245, 245, 0.8);
        --card-border: rgba(30, 41, 63, 0.12);
        --text: #0f172a;
        --muted: rgba(15, 23, 42, 0.65);
      }

      html,
      body {
        margin: 0;
        padding: 0;
        background: transparent;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", sans-serif;
        color: var(--text);
      }

      /* “Card” demo (pode remover se já existir no CRM) */
      .map-card {
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
        padding: 14px;
        border: 1px solid var(--card-border);
        background: var(--card-bg);
        border-radius: 16px;
        max-width: 920px;
      }

      .map-title {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 12px;
      }

      .map-title h2 {
        margin: 0;
        font-size: 14px;
        letter-spacing: 0.2px;
        color: var(--cx-navy);
      }

      .map-title small {
        color: var(--muted);
      }

      /* Container de “fit” do SVG */
      .map-wrap {
        position: relative;
        width: 100%;
        height: 100%;
        max-height: 320px; /* ajuste aqui para o seu card */
        min-height: 220px;
        display: grid;
        place-items: center;
        overflow: hidden;
        border-radius: 14px;
        border: 1px solid rgba(30, 41, 63, 0.08);
        background: rgba(255, 255, 255, 0.55);
      }

      /* “Fit”: ocupa o container sem distorcer */
      #consulmax-map-brasil {
        width: 100%;
        height: 100%;
        display: block;
        /* garante que o SVG “caiba” com meet */
      }

      /* Base */
      .state {
        fill: var(--map-fill);
        stroke: var(--map-stroke);
        transition: fill 120ms linear, opacity 120ms linear, filter 120ms linear;
      }

      /* Só UFs clicáveis */
      .state[id] {
        cursor: pointer;
      }
      .state:not([id]) {
        cursor: default;
        pointer-events: none;
        opacity: var(--map-disabled-opacity);
      }

      .state[id]:hover {
        opacity: 0.92;
      }

      /* Active / Selected (selected tem prioridade visual) */
      .state--active {
        fill: var(--map-active) !important;
        opacity: 1 !important;
      }
      .state--selected {
        fill: var(--map-selected) !important;
        opacity: 1 !important;
        filter: drop-shadow(0 0 1.2px rgba(0, 0, 0, 0.25));
      }

      .state[id]:focus {
        outline: none;
        filter: drop-shadow(0 0 0.9px rgba(0, 0, 0, 0.35));
      }

      .map-bg {
        fill: transparent;
        stroke: transparent;
        pointer-events: none;
      }

      /* Exemplo de layout lado a lado (se quiser) */
      @media (min-width: 860px) {
        .map-card {
          grid-template-columns: 1.2fr 0.8fr;
          align-items: start;
        }
      }

      .demo-panel {
        border: 1px solid rgba(30, 41, 63, 0.08);
        border-radius: 14px;
        background: rgba(255, 255, 255, 0.55);
        padding: 12px;
      }
      .demo-panel h3 {
        margin: 0 0 8px;
        font-size: 13px;
        color: var(--cx-navy);
      }
      .demo-panel p {
        margin: 0;
        font-size: 12px;
        color: var(--muted);
        line-height: 1.45;
      }
    </style>
  </head>

  <body>
    <div class="map-card">
      <div>
        <div class="map-title">
          <h2>Mapa por UF • Consulmax</h2>
          <small>clique em um estado</small>
        </div>

        <div class="map-wrap" aria-label="Mapa do Brasil por UF (fit)">
          <svg
            id="consulmax-map-brasil"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 353.845 367.766"
            role="img"
            aria-label="Mapa do Brasil por Unidades Federativas"
            preserveAspectRatio="xMidYMid meet"
          >
            <!-- SEU SVG (mesmo conteúdo) -->
            <!-- ...mantido... -->
            <!-- (Cole aqui o conteúdo completo do <g> ... </g> do seu SVG atual) -->
            <!-- Para manter esta resposta focada, não repliquei todo o SVG enorme aqui.
                 No seu projeto, mantenha exatamente os mesmos <polygon>/<path> já existentes. -->
          </svg>
        </div>
      </div>

      <div class="demo-panel">
        <h3>Painel (demo)</h3>
        <p>
          Este HTML só entrega o mapa + API/eventos. O painel “real” você vai renderizar no React/TSX.
          (Exemplo completo logo abaixo.)
        </p>
      </div>
    </div>

    <script>
      (function () {
        const svg = document.getElementById("consulmax-map-brasil");
        if (!svg) return;

        /** UF selecionada (uma por vez). */
        let selectedUF = null;

        /** conjunto de UFs ativas */
        let activeSet = new Set();

        function normalizeUF(uf) {
          if (!uf) return null;
          const s = String(uf).trim().toUpperCase();
          return /^[A-Z]{2}$/.test(s) ? s : null;
        }

        function emit(name, detail) {
          window.dispatchEvent(new CustomEvent(name, { detail }));
        }

        function applyClassesFor(el) {
          if (!el || !el.id) return;

          // Active
          el.classList.toggle("state--active", activeSet.has(el.id));

          // Selected (prioridade visual)
          el.classList.toggle("state--selected", selectedUF === el.id);
        }

        function refreshAllStates() {
          svg.querySelectorAll(".state[id]").forEach(applyClassesFor);
        }

        function setSelected(uf) {
          const next = normalizeUF(uf);

          // limpa anterior (somente a classe selected)
          if (selectedUF) {
            const prevEl = svg.querySelector(`#${CSS.escape(selectedUF)}`);
            if (prevEl) prevEl.classList.remove("state--selected");
          }

          selectedUF = next;

          if (selectedUF) {
            const el = svg.querySelector(`#${CSS.escape(selectedUF)}`);
            if (el) el.classList.add("state--selected");
          }

          emit("consulmax:uf-selected", { uf: selectedUF });
        }

        function toggleSelected(uf) {
          const n = normalizeUF(uf);
          if (!n) return;
          setSelected(selectedUF === n ? null : n);
        }

        function setActive(ufs) {
          const list = Array.isArray(ufs) ? ufs : [];
          activeSet = new Set(list.map(normalizeUF).filter(Boolean));

          // aplica classe em todas as UFs
          svg.querySelectorAll(".state[id]").forEach((el) => {
            el.classList.toggle("state--active", activeSet.has(el.id));
            // mantém selected intacto
          });

          emit("consulmax:uf-active", { active: Array.from(activeSet).sort() });
        }

        function clearActive() {
          activeSet = new Set();
          svg.querySelectorAll(".state[id].state--active").forEach((el) => el.classList.remove("state--active"));
          emit("consulmax:uf-active", { active: [] });
        }

        // Clique (só em elementos com id)
        svg.addEventListener("click", (e) => {
          const target = e.target;
          if (!target || !target.id) return;
          toggleSelected(target.id);
        });

        // Teclado: Enter/Espaço
        svg.addEventListener("keydown", (e) => {
          const target = e.target;
          if (!target || !target.id) return;
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            toggleSelected(target.id);
          }
        });

        // API simples p/ TSX
        window.consulmaxMap = {
          setSelected,
          getSelected: () => selectedUF,
          setActive,
          getActive: () => Array.from(activeSet),
          clearActive,
          refresh: refreshAllStates,
        };

        // estado inicial consistente
        refreshAllStates();
      })();
    </script>
  </body>
</html>
